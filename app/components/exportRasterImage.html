<script type="text/javascript">
if(typeof electron === 'undefined'){
  electron = require('electron');
}
if(typeof jetpack === 'undefined'){
  jetpack = require('fs-jetpack');
}
if(typeof alertify === 'undefined'){
  alertify = require('alertifyjs');
}

$('#FileTab').after(
  $('<li id="ScreenshotTab" class="disabled"><a href="#">Save Image</a></li>').click(() => {
    electron.remote.dialog.showSaveDialog({
      filters: [
        {name: 'PNG', extensions: ['png']},
        {name: 'JPEG', extensions: ['jpg']}//,
        //{name: 'Bitmap', extensions: ['bmp']}
      ]
    }, (fileName) => {
      if (fileName === undefined){
        return alertify.error('File not exported!');
      }
      electron.remote.getCurrentWindow().capturePage({
        x: 0,
        y: 50,
        width: $(window).width(),
        height: $(window).height()
      }, (img) => {
        var extension = fileName.slice(-3);
        if(extension === 'png'){
          jetpack.write(fileName, img.toPNG());
        } else { //if(extension === 'jpg') {
          jetpack.write(fileName, img.toJPEG(100));
        } //else {
        //  jetpack.write(fileName, 'data:image/bmp;base64,' + img.toBitmap().toString('base64'));
        //}
        alertify.success('File Saved!');
      });
    });
  })
);
</script>
